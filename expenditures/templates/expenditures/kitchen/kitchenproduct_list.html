{% extends "base.html" %}{% load humanize %}
{% block title %}Inventory ¬∑ Kitchen Products{% endblock %}

{% block extra_css %}
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
<style>
:root{
  --indigo:#1e40af; --amber:#f59e0b; --rose:#e11d48; --bg:#f1f5f9; --card:#ffffff; --rad:22px;
}
html,body{margin:0;background:var(--bg);font-family:Inter,sans-serif}
.card{background:var(--card);border-radius:0 0 18px 18px;
      box-shadow:0 4px 14px rgba(0,0,0,.08);opacity:0;transform:translateY(32px);
      transition:.5s cubic-bezier(.25,.8,.25,1)}
.card.show{opacity:1;transform:translateY(0)}
.head{padding:.75rem 1.3rem;border-bottom:1px solid #e2e8f0;
      display:flex;align-items:center;justify-content:space-between}
.head h2{margin:0;font-size:1.35rem;font-weight:700;color:var(--indigo)}
.body{padding:1rem 1.3rem}
.tbl{width:100%;border-collapse:collapse;font-size:.85rem}
.tbl thead{background:var(--indigo);color:#fff}
.tbl th,.tbl td{padding:.5rem .7rem;border-bottom:1px solid #e5e7eb;white-space:nowrap}
.tbl tbody tr:nth-child(even){background:#f8fafc}
.tbl tbody tr:hover{background:#eef2ff}
.text-end{text-align:right}
.bar{height:6px;border-radius:4px;background:#e2e8f0;overflow:hidden}
.bar > span{display:block;height:100%;background:var(--amber)}
.spark{height:30px;width:100px}
.btn{border:none;border-radius:var(--rad);padding:.42rem .9rem;font-size:.8rem;font-weight:600;cursor:pointer;transition:transform .15s}
.btn-indigo{background:var(--indigo);color:#fff}
.btn-rose{background:var(--rose);color:#fff}
.btn:hover{transform:translateY(-2px)}
.kpi{font-size:.9rem;font-weight:600;margin-bottom:.6rem}
.kpi span{color:var(--indigo)}
@media(max-width:700px){.tbl th,.tbl td{padding:.4rem;font-size:.75rem}}
</style>
{% endblock %}

{% block extra_js %}
<script src="https://cdn.jsdelivr.net/npm/chart.js@4"></script>
<script>
document.addEventListener("DOMContentLoaded",()=>{
  /* slide-in */
  document.querySelector(".card").classList.add("show");

  /* draw tiny sparklines */
  const rows = JSON.parse(document.getElementById("usage-json").textContent);
  rows.forEach(r=>{
     const ctx = document.getElementById("spark-"+r.id);
     new Chart(ctx,{type:"bar",
       data:{labels:Array(30).fill(""),datasets:[{data:r.series,backgroundColor:"rgba(30,64,175,.6)"}]},
       options:{responsive:false,animation:false,plugins:{legend:{display:false}},scales:{x:{display:false},y:{display:false}}}
     });
  });
});
</script>
{% endblock %}

{% block content %}
<div class="card">
  <!-- heading -->
  <div class="head">
    <h2>üçΩÔ∏è&nbsp;Kitchen Products</h2>
    <a href="{% url 'kitchenproduct_create' %}" class="btn btn-indigo">‚ûï New</a>
  </div>

  <div class="body">
    <!-- KPI summary -->
    <p class="kpi">
      Purchased <span>{{ total_purchased|floatformat:2|intcomma }}</span> |
      Consumed <span>{{ total_consumed|floatformat:2|intcomma }}</span> |
      On-hand <span>{{ total_balance|floatformat:2|intcomma }}</span>
    </p>

    <!-- table -->
    <div style="overflow-x:auto">
      <table class="tbl">
        <thead>
          <tr>
            <th>#</th><th>Name</th><th>Unit</th>
            <th class="text-end">Purchased</th>
            <th class="text-end">Consumed</th>
            <th class="text-end">On-hand</th>
            <th>30-day usage</th>
            <th style="width:110px">Actions</th>
          </tr>
        </thead>
        <tbody>
        {% for k in rows %}
          <tr>
            <td>{{ forloop.counter }}</td>
            <td>{{ k.name }}</td>
            <td>{{ k.unit }}</td>
            <td class="text-end">{{ k.purchased|floatformat:2 }}</td>
            <td class="text-end">{{ k.used|floatformat:2 }}</td>
            <td>
              <div class="bar" title="{{ k.remaining_pct }} % left">
                <span style="width:{{ k.remaining_pct }}%"></span>
              </div>
            </td>
            <td><canvas id="spark-{{ k.pk }}" class="spark"></canvas></td>
            <td>
              <a href="{% url 'kitchenproduct_update' k.pk %}" class="btn btn-indigo">‚úè</a>
              <a href="{% url 'kitchenproduct_delete' k.pk %}" class="btn btn-rose"
                 onclick="return confirm('Delete {{ k.name }}?')">üóë</a>
            </td>
          </tr>
        {% empty %}
          <tr><td colspan="8">No kitchen products recorded.</td></tr>
        {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
</div>

{# ‚Äî‚Äî‚Äî JSON payload for sparklines ‚Äî‚Äî‚Äî #}
<script id="usage-json" type="application/json">
[
{% for k in rows %}
  {"id":"{{ k.pk }}","series":[{{ k.usage_30d|join:"," }}]}{% if not forloop.last %},{% endif %}
{% endfor %}
]
</script>
{% endblock %}

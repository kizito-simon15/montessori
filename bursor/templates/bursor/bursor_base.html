{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>{% block title %}Bursor â€¢ Victory School{% endblock %}</title>

  <!-- â”€â”€â”€ core libs â”€â”€â”€ -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/toastr@2.1.4/build/toastr.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

  <!-- â”€â”€â”€ theme vars â”€â”€â”€ -->
  <style>
    :root{
      --clr-primary:#0f766e;        /* teal-600 â€“ finance vibe                */
      --clr-accent:#14b8a6;         /* teal-400                               */
      --clr-sidebar:#083344;        /* darker teal                            */
      --h-topbar:64px;              /* JS sync after load                     */
      --w-sidebar:260px;
      --w-sidebar-xs:82vw;
    }

    /* === GLOBAL === */
    body{margin:0;font-family:'Inter',sans-serif;background:#f9fafb;color:#111;
         overflow-x:hidden;transition:background .3s,color .3s;}
    .hidden{display:none!important}.pe-none{pointer-events:none!important}

    /* === PUSH LAYOUT WHEN SIDEBAR OPEN (â‰¥lg) === */
    body.sb-open .vs-topbar,body.sb-open main{margin-left:var(--w-sidebar);}
    body.sb-open .vs-topbar{width:calc(100% - var(--w-sidebar));}
    @media(max-width:992px){
      body.sb-open .vs-topbar,body.sb-open main{margin-left:0;width:100%;}
    }

    /* === SIDEBAR === */
    .sidebar{
      position:fixed;top:var(--h-topbar);left:0;z-index:1052;
      width:var(--w-sidebar);height:calc(100vh - var(--h-topbar));
      background:var(--clr-sidebar);
      background-image:linear-gradient(#0f766e,#083344 60%);
      overflow-y:auto;scrollbar-width:none;transition:transform .3s;
      transform:translateX(-100%);
    }
    body.sb-open .sidebar{transform:translateX(0);}
    .sidebar::-webkit-scrollbar{display:none;}
    @media(max-width:992px){.sidebar{width:var(--w-sidebar-xs);} }

    /* overlay when sidebar open on mobile */
    #overlay{position:fixed;inset:0;background:rgba(0,0,0,.55);backdrop-filter:blur(2px);
      z-index:1051;transition:opacity .3s;}

    /* === TOP BAR === */
    .vs-topbar{
      position:fixed;top:0;left:0;right:0;z-index:1053;
      display:flex;align-items:center;justify-content:space-between;
      gap:1rem;padding:0 1.25rem;height:var(--h-topbar);
      background:linear-gradient(90deg,var(--clr-accent),var(--clr-primary));
      color:#fff;box-shadow:0 2px 4px rgba(0,0,0,.1);
    }
    .vs-brand{font-weight:700;font-size:1rem;}

    /* toggle button sits *inside* the bar */
    #vsToggle{display:inline-flex;align-items:center;justify-content:center;
      width:38px;height:38px;border:none;border-radius:50%;background:#ffffff14;
      font-size:20px;cursor:pointer;}
    #vsToggle:hover{background:#ffffff2e;}

    .vs-tools{display:flex;align-items:center;gap:.7rem;}
    .vs-icon{display:inline-flex;align-items:center;justify-content:center;
      width:34px;height:34px;background:#ffffff14;border-radius:50%;font-size:18px;}
    .vs-icon:hover{background:#ffffff2e;}

    .vs-avatar{width:32px;height:32px;border-radius:50%;overflow:hidden;}

    /* === MAIN WRAPPER === */
    main{min-height:100vh;padding:calc(var(--h-topbar)+1rem) 0 1rem;
         transition:margin-left .3s;}

    /* keep full width for inner bootstrap containers */
    .container{max-width:100%!important;padding:0 .75rem!important;}
  </style>
  {% block extra_css %}{% endblock %}
</head>

<body>
  <div id="overlay" class="hidden opacity-0 pe-none"></div>

  {# â€“â€“ SIDEBAR â€“â€“ #}
  <aside class="sidebar" id="sidebar">
    {% include "bursor/sidebar.html" %}
  </aside>

  {# â€“â€“ TOP BAR â€“â€“ #}
  <header class="vs-topbar">
    <button id="vsToggle" title="Toggle menu">â˜°</button>
    <span class="vs-brand">Bursor Panel</span>

    <div class="vs-tools text-sm">
      <span class="d-none d-md-inline">ðŸ“… {{ current_session }} â€¢ {{ current_term }}</span>

      {# placeholder for possible notifications #}
      <button class="vs-icon position-relative">
        <i class="bi bi-bell-fill"></i>
        {% if notification_count %}
          <span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger">
            {{ notification_count }}
          </span>
        {% endif %}
      </button>

      <div class="dropdown">
        <button class="vs-avatar border-0 bg-transparent" data-bs-toggle="dropdown">
          {% if request.user.profile_picture %}
            <img src="{{ request.user.profile_picture.url }}" alt="">
          {% else %}
            <img src="{% static 'images/avatar.png' %}" alt="">
          {% endif %}
        </button>
        <ul class="dropdown-menu dropdown-menu-end shadow rounded-lg text-sm">
          <li><h6 class="dropdown-header">{{ request.user.get_full_name }}</h6></li>
          <li><a class="dropdown-item" href="{ url 'bursor_profile' }">
                <i class="bi bi-person me-2"></i>Profile</a></li>
          <li><hr class="dropdown-divider"></li>
          <li><a class="dropdown-item" href="{% url 'logout' %}">
                <i class="bi bi-box-arrow-right me-2"></i>Logout</a></li>
        </ul>
      </div>
    </div>
  </header>

  {# â€“â€“ MAIN â€“â€“ #}
  <main>
    <div class="container">{% block content %}{% endblock %}</div>
  </main>

  <!-- â”€â”€â”€ scripts â”€â”€â”€ -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/toastr@2.1.4/build/toastr.min.js"></script>

  <script>
  /* ---------- layout helpers ---------- */
  (() => {
    const body=document.body, sb=document.getElementById('sidebar'),
          ovl=document.getElementById('overlay'), tgl=document.getElementById('vsToggle');

    const syncH=() =>{
      document.documentElement.style.setProperty('--h-topbar',
          document.querySelector('.vs-topbar').offsetHeight+'px');
    };
    addEventListener('load', syncH);
    addEventListener('resize', syncH);

    const apply=(open)=>{
      body.classList.toggle('sb-open',open);
      const phone=innerWidth<992;
      ['hidden','pe-none','opacity-0'].forEach(c=>ovl.classList.toggle(c,!(open&&phone)));
    };
    const saved = localStorage.getItem('bursorSb')??'1';
    apply(innerWidth>=992 ? saved==='1' : false);

    tgl.onclick=()=>{const o=!body.classList.contains('sb-open');
      apply(o); if(innerWidth>=992) localStorage.setItem('bursorSb',o?'1':'0');};
    ovl.onclick=()=>apply(false);
    addEventListener('resize',()=>{if(innerWidth<992) apply(false);});
  })();

  /* ---------- toastr ---------- */
  {% if messages %}
    toastr.options={progressBar:true,closeButton:true,timeOut:5000};
    {% for m in messages %}
      toastr["{{ m.tags|default:'info' }}"]("{{ m|escapejs }}");
    {% endfor %}
  {% endif %}
  </script>

  {% block extra_js %}{% endblock %}
</body>
</html>

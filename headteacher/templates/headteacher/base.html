{% load static %}{% load humanize %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>{% block title %}Head-Teacher ‚Ä¢ Victory{% endblock %}</title>

  <!-- libs -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap">

  <!-- core styles -->
  <style>
    :root{
      --clr-primary:#2563eb; --clr-accent:#f97316;
      --clr-sidebar:#0f172a; --w-sidebar:260px; --w-sidebar-xs:80vw;
      --h-topbar:64px;
    }
    body{
      margin:0;font-family:Inter,sans-serif;background:#f9fafb;color:#111;
      transition:background .3s,color .3s;
    }
    body.dark{background:#0f172a;color:#e2e8f0;}
    main{min-height:100vh;padding:calc(var(--h-topbar) + 1.25rem) 0 1.25rem;transition:margin-left .3s;}

    /* topbar */
    .ht-topbar{
      position:fixed;top:0;left:0;right:0;z-index:1053;
      display:flex;align-items:center;justify-content:space-between;gap:1rem;
      padding:0 .9rem;height:var(--h-topbar);color:#fff;
      background:linear-gradient(90deg,var(--clr-accent),var(--clr-primary));
      box-shadow:0 2px 4px rgba(0,0,0,.12);
    }
    .icon-btn{display:inline-flex;align-items:center;justify-content:center;
      width:34px;height:34px;border:none;border-radius:50%;cursor:pointer;
      font-size:1.15rem;background:rgba(255,255,255,.18);color:#fff;}
    .icon-btn:hover{background:rgba(255,255,255,.3);}

    /* avatar */
    .avatar-btn{border:none;background:transparent;width:36px;height:36px;
      padding:0;border-radius:50%;overflow:hidden;cursor:pointer;}
    .avatar-btn img{width:100%;height:100%;object-fit:cover;}

    /* sidebar */
    .sidebar{
      position:fixed;top:var(--h-topbar);left:0;z-index:1052;
      width:var(--w-sidebar);height:calc(100vh - var(--h-topbar));
      background:var(--clr-sidebar);background-image:linear-gradient(#1e293b 0%,#0f172a 60%);
      overflow-y:auto;transform:translateX(-100%);transition:transform .3s;
      scrollbar-width:none;
    }
    .sidebar::-webkit-scrollbar{display:none;}
    body.sb-open .sidebar{transform:none;}
    body.sb-open main{margin-left:var(--w-sidebar);}
    @media(max-width:992px){.sidebar{width:var(--w-sidebar-xs);} body.sb-open main{margin-left:0;}}

    /* overlay */
    #overlay{position:fixed;inset:0;z-index:1051;background:rgba(0,0,0,.55);
      backdrop-filter:blur(3px);transition:opacity .3s;}
    .hidden{display:none!important}.pe-none{pointer-events:none!important}

    /* notifications dot */
    .pulse-dot{position:absolute;top:6px;right:6px;width:10px;height:10px;
      border-radius:50%;background:#ef4444;animation:pulse 2s infinite;}
    @keyframes pulse{0%,100%{transform:scale(.8);opacity:.8}50%{transform:scale(1.4);opacity:.3}}
  </style>
  {% block extra_css %}{% endblock %}
</head>
<body>

  <!-- overlay -->
  <div id="overlay" class="hidden opacity-0 pe-none"></div>

  <!-- sidebar -->
  <aside id="sidebar" class="sidebar">
    {% include "partials/ht_sidebar.html" %}
  </aside>

  <!-- topbar -->
  <header class="ht-topbar">
    <button id="sbToggle" class="icon-btn">‚ò∞</button>
    <span class="fw-bold small text-truncate">Victory ‚Ä¢ Head-Teacher</span>

    <div class="d-flex align-items-center gap-2">
      <a class="btn btn-sm btn-light fw-semibold" href="{% url 'send_sms_form' %}">‚úâÔ∏è Send&nbsp;SMS</a>
      <button id="dmBtn" class="icon-btn">üåô</button>
      <button class="icon-btn position-relative">üõéÔ∏è
        {% if notification_count|default:0 %}
          <span class="pulse-dot"></span>
        {% endif %}
      </button>
      <div class="dropdown">
        <button class="avatar-btn" data-bs-toggle="dropdown">
          {% if request.user.profile_picture %}
            <img src="{{ request.user.profile_picture.url }}" alt="avatar">
          {% else %}
            <img src="{% static 'images/avatar.png' %}" alt="avatar">
          {% endif %}
        </button>
        <ul class="dropdown-menu dropdown-menu-end shadow-lg rounded-3 mt-2">
          <li class="dropdown-header fw-semibold">{{ request.user.username }}</li>
          <li><a class="dropdown-item" href="{% url 'profile' %}"><i class="bi bi-person me-2"></i>Profile</a></li>
          <li><hr class="dropdown-divider"></li>
          <li><a class="dropdown-item" href="{% url 'logout' %}"><i class="bi bi-box-arrow-right me-2"></i>Logout</a></li>
        </ul>
      </div>
    </div>
  </header>

  <!-- main -->
  <main>
    <div class="container-fluid py-3">{% block content %}{% endblock %}</div>
  </main>

  <!-- scripts -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script>
  (()=> {
    const body=document.body,ovl=document.getElementById('overlay'),
          btn=document.getElementById('sbToggle');
    const setSB=open=>{
      body.classList.toggle('sb-open',open);
      const phone=innerWidth<992;
      ['hidden','pe-none','opacity-0'].forEach(c=>ovl.classList.toggle(c,!(open&&phone)));
      if(innerWidth>=992) localStorage.setItem('ht_sb',open?'1':'0');
    };
    setSB(innerWidth<992 ? false : (localStorage.getItem('ht_sb')??'1')==='1');
    btn.onclick = ()=>setSB(!body.classList.contains('sb-open'));
    ovl.onclick = ()=>setSB(false);
    addEventListener('resize',()=>{if(innerWidth<992) setSB(false);});

    const dm=document.getElementById('dmBtn');
    const syncDM=()=>{
      const on=localStorage.getItem('ht_dm')==='1';
      body.classList.toggle('dark',on);
      dm.textContent=on?'‚òÄÔ∏è':'üåô';
    };
    dm.onclick=()=>{localStorage.setItem('ht_dm',body.classList.contains('dark')?'0':'1');syncDM();};
    syncDM();
  })();
  </script>
  {% block extra_js %}{% endblock %}
</body>
</html>
